<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Desafio dos Sólidos — Standalone</title>
<style>
  :root{
    --bg1: #ffecd2;
    --bg2: #fcb69f;
    --accent: #7c3aed;
    --accent-2: #06b6d4;
    --card: #ffffff;
    --muted: #4b5563;
  }
  html,body{height:100%;}
  body{
    margin:0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }

  .game {
    width:100%;
    max-width:1000px;
    background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.92));
    border-radius:18px;
    box-shadow: 0 10px 30px rgba(16,24,40,0.18);
    overflow:hidden;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:18px;
  }

  header{
    grid-column:1/-1;
    padding:20px 28px;
    display:flex;
    align-items:center;
    gap:18px;
  }
  .logo {
    width:68px;height:68px;border-radius:12px;
    background: linear-gradient(135deg,var(--accent),var(--accent-2));
    color:white; display:flex;align-items:center;justify-content:center;
    font-weight:700;font-size:20px;box-shadow:0 6px 18px rgba(124,58,237,0.28);
  }
  h1{margin:0;font-size:20px;}
  p.lead{margin:0;color:var(--muted);font-size:13px;}

  main{
    padding:20px;
  }
  aside{
    padding:20px;
    border-left: 1px dashed rgba(16,24,40,0.05);
    background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));
  }

  .stats{
    display:flex;gap:8px;margin-bottom:12px;
  }
  .stat{
    background: linear-gradient(180deg,#fff,#f9fafb);
    padding:10px;border-radius:10px;flex:1;text-align:center;
    box-shadow:0 4px 10px rgba(2,6,23,0.06);
  }
  .stat small{display:block;color:var(--muted);font-size:12px;}
  .stat strong{display:block;font-size:18px;margin-top:6px;}

  .controls{display:flex;gap:8px;margin-bottom:14px;align-items:center;}
  .btn{
    padding:8px 10px;border-radius:10px;border:0;cursor:pointer;font-weight:600;
    box-shadow: 0 6px 14px rgba(2,6,23,0.06);
  }
  .btn-primary{background:linear-gradient(90deg,var(--accent),#5b21b6); color:white;}
  .btn-ghost{background:transparent;border:2px solid rgba(16,24,40,0.06);}

  .card{
    background:var(--card);padding:14px;border-radius:12px;margin-bottom:12px;
    box-shadow: 0 8px 20px rgba(2,6,23,0.05);
  }

  .solid-name{font-weight:700;font-size:18px;margin-bottom:6px;}
  .hint{color:var(--muted);font-size:13px;margin-bottom:10px;}

  .params{font-size:13px;color:#334155;margin-bottom:10px;}
  .input-row{display:flex;gap:8px;align-items:center;}
  input[type=number]{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(2,6,23,0.06);font-size:14px;text-align:center;}
  .small{font-size:12px;color:var(--muted);}

  /* flashy background when success/error */
  .flash-success{animation: flashGreen 0.45s ease;}
  .flash-error{animation: flashRed 0.45s ease;}
  @keyframes flashGreen{0%{box-shadow:0 0 0 rgba(16,185,129,0)}50%{box-shadow:0 0 40px rgba(16,185,129,0.12)}100%{box-shadow:0 0 0 rgba(16,185,129,0)}}
  @keyframes flashRed{0%{box-shadow:0 0 0 rgba(239,68,68,0)}50%{box-shadow:0 0 40px rgba(239,68,68,0.12)}100%{box-shadow:0 0 0 rgba(239,68,68,0)}}

  .footer {font-size:12px;color:var(--muted);margin-top:8px;}

  /* responsive */
  @media (max-width:920px){
    .game{grid-template-columns:1fr; }
    aside{border-left:none;border-top:1px dashed rgba(16,24,40,0.05);}
  }

  /* nets small visuals */
  .net {
    width:100%;height:86px;border-radius:8px;background:linear-gradient(180deg,#fff,#fbfbff);
    display:flex;align-items:center;justify-content:center;border:1px dashed rgba(2,6,23,0.06);
  }
  .mode-pill{font-size:12px;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.6);border:1px solid rgba(2,6,23,0.04);}
</style>
</head>
<body>
<div class="game" id="gameRoot">
  <header>
    <div class="logo">GEO</div>
    <div>
      <h1>Desafio dos Sólidos — Versão Offline</h1>
      <p class="lead">Jogo educativo: calcule volumes. Modo Single e 2-Players. Sons e animações inclusos.</p>
    </div>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
      <div class="mode-pill" id="clickToEnableAudio">Clique para ativar som</div>
    </div>
  </header>

  <main>
    <div class="card">
      <div class="stats">
        <div class="stat"><small>Tempo</small><strong id="timeLeft">60s</strong></div>
        <div class="stat"><small>Nível</small><strong id="level">1</strong></div>
        <div class="stat"><small>Pontuação (vez 1 / 2)</small><strong id="scoreDisplay">0 — 0</strong></div>
      </div>

      <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:12px;">
        <div class="controls">
          <button class="btn btn-primary" id="btnSingle">Single</button>
          <button class="btn btn-ghost" id="btnDuo">2 Players</button>
        </div>
        <div style="margin-left:auto;display:flex;gap:8px;">
          <button class="btn btn-ghost" id="btnReset">Reiniciar</button>
          <button class="btn btn-ghost" id="btnHelp">Instruções</button>
        </div>
      </div>

      <div class="card" id="challengeCard" style="display:block;">
        <div class="solid-name" id="solidName">Cubo</div>
        <div class="hint" id="solidHint">6 faces quadradas</div>
        <div class="net" id="netVisual"><svg viewBox="0 0 200 120" style="width:90%;height:80%"><rect x="60" y="10" width="40" height="40" stroke="#111" fill="#f8fafc"/><rect x="60" y="50" width="40" height="40" stroke="#111" fill="#f1f5f9"/><rect x="20" y="50" width="40" height="40" stroke="#111" fill="#eef2ff"/><rect x="100" y="50" width="40" height="40" stroke="#111" fill="#fff7ed"/><rect x="140" y="50" width="40" height="40" stroke="#111" fill="#ecfccb"/><rect x="60" y="90" width="40" height="20" stroke=\"#111\" fill=\"#fde68a\"/></svg></div>

        <div class="params" id="paramList">aresta: 3 cm</div>

        <div class="input-row">
          <input id="answerInput" type="number" placeholder="Digite o volume (cm³)" />
          <button class="btn btn-primary" id="btnCheck">Verificar</button>
        </div>
        <div style="margin-top:10px; display:flex;gap:8px;align-items:center;">
          <div class="small" id="messageBox">Boa sorte! Acertos aumentam nível e dão tempo extra.</div>
        </div>
      </div>
    </div>
  </main>

  <aside>
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div><strong>Controles & Regras</strong></div>
      </div>
      <ul class="small" style="line-height:1.6;">
        <li>Escolha Single ou 2-Players. Em 2-Players, cada erro troca o turno.</li>
        <li>Acertos: pontos para o jogador da vez, aumentam nível e adicionam tempo.</li>
        <li>Erros: perdem pontos e, em 2-Players, trocam o turno.</li>
        <li>Sons são gerados localmente (Web Audio) — clique no topo para ativar se não ouvir nada.</li>
      </ul>
      <div class="footer">Dica: responda com número aproximado: o jogo aceita uma pequena tolerância.</div>
    </div>

    <div class="card" style="margin-top:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div><strong>Status</strong></div>
        <div class="small" id="turnLabel">Jogador: 1</div>
      </div>
      <div style="margin-top:8px;"><strong id="statusMsg">Pronto!</strong></div>
    </div>
  </aside>
</div>

<script>
/* ========= Game logic (standalone) ========= */
/* Solids with volume functions and params description */
const SOLIDS = [
  { id: 'cube', name: 'Cubo', hint: '6 faces quadradas', param: ['aresta'], volume: (a) => a ** 3, net:'cube' },
  { id: 'rectprism', name: 'Paralelepípedo', hint: 'Faces retangulares', param: ['comprimento','largura','altura'], volume: (a,b,c) => a*b*c, net:'rectprism' },
  { id: 'cylinder', name: 'Cilindro', hint: '2 bases circulares', param: ['raio','altura'], volume: (r,h) => Math.PI * r * r * h, net:'cylinder' },
  { id: 'cone', name: 'Cone', hint: '1 base circular + vértice', param: ['raio','altura'], volume: (r,h) => (Math.PI * r * r * h)/3, net:'cone' },
  { id: 'pyramid', name: 'Pirâmide (base quadrada)', hint: 'Base quadrada + faces triangulares', param: ['aresta da base','altura'], volume: (a,h) => (a*a*h)/3, net:'pyramid' },
  { id: 'sphere', name: 'Esfera', hint: 'Superfície contínua', param: ['raio'], volume: (r) => (4/3) * Math.PI * r * r * r, net:'sphere' }
];

let mode = 'single'; // 'single' or 'duo'
let level = 1;
let timeLeft = 60;
let scores = [0, 0]; // player1, player2
let playerTurn = 0; // 0 or 1
let currentSolid = null;
let params = [];
let running = true;
let flashTimeout = null;

/* DOM */
const timeLeftEl = document.getElementById('timeLeft');
const levelEl = document.getElementById('level');
const scoreDisplay = document.getElementById('scoreDisplay');
const solidNameEl = document.getElementById('solidName');
const solidHintEl = document.getElementById('solidHint');
const paramListEl = document.getElementById('paramList');
const answerInput = document.getElementById('answerInput');
const messageBox = document.getElementById('messageBox');
const btnCheck = document.getElementById('btnCheck');
const btnReset = document.getElementById('btnReset');
const btnSingle = document.getElementById('btnSingle');
const btnDuo = document.getElementById('btnDuo');
const btnHelp = document.getElementById('btnHelp');
const statusMsg = document.getElementById('statusMsg');
const turnLabel = document.getElementById('turnLabel');
const scoreDisplayEl = document.getElementById('scoreDisplay');
const netVisual = document.getElementById('netVisual');
const clickToEnableAudio = document.getElementById('clickToEnableAudio');

/* Audio using Web Audio API — game-like effects */
let audioCtx = null;
function ensureAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}
/* simple "sfx" generator: uses multiple oscillators + noise bursts for game sound */
function playSuccess() {
  try {
    ensureAudio();
    const ctx = audioCtx;
    const t = ctx.currentTime;

    // short bright chime
    const o1 = ctx.createOscillator(); o1.type='sine'; o1.frequency.value=880;
    const o2 = ctx.createOscillator(); o2.type='sine'; o2.frequency.value=1320;
    const g = ctx.createGain(); g.gain.value=0.0001;
    o1.connect(g); o2.connect(g); g.connect(ctx.destination);
    g.gain.setValueAtTime(0.0001,t); g.gain.exponentialRampToValueAtTime(0.18,t+0.01);
    o1.start(t); o2.start(t);
    g.gain.exponentialRampToValueAtTime(0.0001,t+0.35);
    o1.stop(t+0.37); o2.stop(t+0.37);
  } catch(e){/*ignore*/ }
}
function playFail() {
  try {
    ensureAudio();
    const ctx = audioCtx; const t = ctx.currentTime;
    const o = ctx.createOscillator(); o.type='sawtooth'; o.frequency.value=160;
    const g = ctx.createGain(); g.gain.value=0.0001;
    o.connect(g); g.connect(ctx.destination);
    g.gain.setValueAtTime(0.0001, t); g.gain.exponentialRampToValueAtTime(0.18,t+0.01);
    o.start(t);
    g.gain.exponentialRampToValueAtTime(0.0001,t+0.5);
    o.stop(t+0.52);
  } catch(e){/*ignore*/ }
}
function playLevelUp() {
  try {
    ensureAudio();
    const ctx = audioCtx; const t = ctx.currentTime;
    // arpeggio
    [660,880,1100].forEach((freq,i)=>{
      const o = ctx.createOscillator(); o.type='triangle'; o.frequency.value=freq;
      const g = ctx.createGain(); o.connect(g); g.connect(ctx.destination);
      g.gain.setValueAtTime(0.0001, t + i*0.06);
      g.gain.exponentialRampToValueAtTime(0.18, t + i*0.06 + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t + i*0.06 + 0.22);
      o.start(t + i*0.06); o.stop(t + i*0.06 + 0.24);
    });
  } catch(e){/*ignore*/ }
}

/* UI helpers */
function updateUI(){
  timeLeftEl.textContent = timeLeft + 's';
  levelEl.textContent = level;
  scoreDisplayEl.textContent = `${scores[0]} — ${scores[1]}`;
  turnLabel.textContent = mode === 'single' ? 'Player: Single' : `Jogador: ${playerTurn+1}`;
}
function showMessage(msg){
  messageBox.textContent = msg;
  statusMsg.textContent = msg;
}

/* Generate next challenge */
function nextChallenge(){
  currentSolid = SOLIDS[Math.floor(Math.random() * SOLIDS.length)];
  // choose params random 1..6
  params = currentSolid.param.map(()=> Math.floor(Math.random()*6)+1);
  // show net visual by replacing innerHTML with small SVGs depending on id
  renderNet(currentSolid.id);
  solidNameEl.textContent = currentSolid.name;
  solidHintEl.textContent = currentSolid.hint;
  // param list
  const pText = currentSolid.param.map((p,i)=> `${p}: ${params[i]} cm`).join(' • ');
  paramListEl.textContent = pText;
  answerInput.value = '';
  showMessage(`Nível ${level}: calcule o volume do ${currentSolid.name}.`);
}

/* small SVG nets (simplified) */
function renderNet(id){
  let svg = '';
  switch(id){
    case 'cube':
      svg = `<svg viewBox="0 0 200 120" style="width:90%;height:80%"><rect x="60" y="10" width="40" height="40" stroke="#111" fill="#fffbeb"/><rect x="60" y="50" width="40" height="40" stroke="#111" fill="#fff1f2"/><rect x="20" y="50" width="40" height="40" stroke="#111" fill="#ecfeff"/><rect x="100" y="50" width="40" height="40" stroke="#111" fill="#f0f9ff"/><rect x="140" y="50" width="40" height="40" stroke="#111" fill="#eef2ff"/><rect x="60" y="90" width="40" height="20" stroke="#111" fill="#fde68a"/></svg>`;
      break;
    case 'rectprism':
      svg = `<svg viewBox="0 0 220 120" style="width:90%;height:80%"><rect x="10" y="20" width="60" height="60" stroke="#111" fill="#fff7ed"/><rect x="70" y="20" width="60" height="60" stroke="#111" fill="#ecfeff"/><rect x="130" y="20" width="60" height="60" stroke="#111" fill="#eef2ff"/></svg>`;
      break;
    case 'cylinder':
      svg = `<svg viewBox="0 0 200 120" style="width:90%;height:80%"><ellipse cx="100" cy="24" rx="44" ry="12" stroke="#111" fill="#fff"/><rect x="56" y="24" width="88" height="52" stroke="#111" fill="#fef3c7"/><ellipse cx="100" cy="76" rx="44" ry="12" stroke="#111" fill="#fff"/></svg>`;
      break;
    case 'cone':
      svg = `<svg viewBox="0 0 200 120" style="width:90%;height:80%"><path d="M40 90 L100 20 L160 90 Z" stroke="#111" fill="#fff1f2"/><ellipse cx="100" cy="92" rx="40" ry="10" stroke="#111" fill="#fff"/></svg>`;
      break;
    case 'pyramid':
      svg = `<svg viewBox="0 0 200 120" style="width:90%;height:80%"><rect x="80" y="60" width="40" height="30" stroke="#111" fill="#ecfccb"/><path d="M60 60 L100 20 L140 60 Z" stroke="#111" fill="#fef3c7"/></svg>`;
      break;
    case 'sphere':
      svg = `<svg viewBox="0 0 200 120" style="width:90%;height:80%"><circle cx="100" cy="60" r="34" stroke="#111" fill="#eef2ff"/><path d="M66 60 Q100 44 134 60" stroke="#111" fill="none"/></svg>`;
      break;
    default: svg='';
  }
  netVisual.innerHTML = svg;
}

/* Check answer */
function checkAnswer(){
  if(!currentSolid) return;
  const expected = currentSolid.volume(...params);
  const userValue = parseFloat(answerInput.value);
  // tolerance: 2% or 0.2 absolute
  const tolerance = Math.max(0.2, Math.abs(expected) * 0.02);

  if (Number.isFinite(userValue) && Math.abs(userValue - expected) <= tolerance) {
    // correct
    // visual flash
    flash('success');
    playSuccess();
    const delta = 15 * level;
    scores[playerTurn] += delta;
    showMessage(`✅ Correto! Jogador ${playerTurn+1} +${delta} pontos`);
    playLevelUp();
    level += 1;
    timeLeft += 12;
  } else {
    // wrong
    flash('error');
    playFail();
    scores[playerTurn] = Math.max(0, scores[playerTurn] - 5);
    showMessage(`❌ Errado! O volume era ${expected.toFixed(2)}. -5 pontos (Jogador ${playerTurn+1})`);
    // in duo mode change turn
    if(mode === 'duo') playerTurn = 1 - playerTurn;
  }
  updateUI();
  // next challenge
  setTimeout(()=> nextChallenge(), 300);
}

/* flash background animation */
function flash(type){
  const root = document.getElementById('gameRoot');
  root.classList.remove('flash-success','flash-error');
  if(flashTimeout) clearTimeout(flashTimeout);
  if(type==='success') root.classList.add('flash-success');
  else root.classList.add('flash-error');
  flashTimeout = setTimeout(()=> { root.classList.remove('flash-success','flash-error'); }, 500);
}

/* timer loop */
function tick(){
  if(!running) return;
  timeLeft -= 1;
  if(timeLeft <= 0){
    running = false;
    showMessage(finalMessage());
  }
  updateUI();
}

/* final message */
function finalMessage(){
  if(mode === 'single') return `⏰ Tempo esgotado! Sua pontuação final: ${scores[0]}`;
  const [a,b] = scores;
  if(a === b) return `⏰ Empate! ${a} — ${b}`;
  return `⏰ Fim! Jogador 1: ${a} — Jogador 2: ${b}. Vencedor: ${a>b ? 'Jogador 1' : 'Jogador 2'}`;
}

/* controls */
btnCheck.addEventListener('click', ()=> { checkAnswer(); });
answerInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') checkAnswer(); });
btnReset.addEventListener('click', ()=> {
  level = 1; timeLeft = 60; scores = [0,0]; playerTurn = 0; running = true; updateUI(); nextChallenge(); showMessage('Jogo reiniciado. Boa sorte!');
});
btnSingle.addEventListener('click', ()=> { mode='single'; btnSingle.classList.add('btn-primary'); btnDuo.classList.remove('btn-primary'); btnDuo.classList.add('btn-ghost'); btnSingle.classList.remove('btn-ghost'); level=1; timeLeft=60; scores=[0,0]; playerTurn=0; running=true; updateUI(); nextChallenge(); });
btnDuo.addEventListener('click', ()=> { mode='duo'; btnDuo.classList.add('btn-primary'); btnSingle.classList.remove('btn-primary'); btnSingle.classList.add('btn-ghost'); btnDuo.classList.remove('btn-ghost'); level=1; timeLeft=60; scores=[0,0]; playerTurn=0; running=true; updateUI(); nextChallenge(); });
btnHelp.addEventListener('click', ()=> { alert('Regras rápidas:\\n- Acertos dão pontos e tempo extra.\\n- Erros tiram pontos e, no modo 2-players, trocam o turno.\\n- Use números aproximados (tolerância ~2%).'); });

/* Allow user to activate audio by clicking top pill */
clickToEnableAudio.addEventListener('click', ()=> {
  try {
    ensureAudio();
    // try small silent resume
    audioCtx.resume && audioCtx.resume();
    clickToEnableAudio.textContent = 'Áudio ativado ✔';
    clickToEnableAudio.style.background = 'linear-gradient(90deg,#ffffff,#f3f4f6)';
  } catch(e){}
});

/* initialize */
updateUI();
nextChallenge();
showMessage('Clique em "Single" ou "2 Players" para começar.');

setInterval(tick, 1000);

/* safety: when page becomes hidden, pause timer */
document.addEventListener('visibilitychange', ()=> {
  if(document.hidden) running = false;
  else if (!document.hidden && timeLeft>0) running = true;
});
</script>
</body>
</html>
